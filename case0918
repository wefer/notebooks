{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "from datetime import datetime\n",
    "import pandas as pd\n",
    "import sklearn as skl\n",
    "from matplotlib import pyplot as plt\n",
    "%matplotlib inline"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "##### Read in the data and see what it looks like"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Kundnr</th>\n",
       "      <th>Status_L</th>\n",
       "      <th>Status_A</th>\n",
       "      <th>Target_Alla</th>\n",
       "      <th>Target_Helt</th>\n",
       "      <th>Target_Delvis</th>\n",
       "      <th>Ref_Alla</th>\n",
       "      <th>Kundperiod_Min</th>\n",
       "      <th>Kundperiod_Max</th>\n",
       "      <th>Avslutsdatum_Max</th>\n",
       "      <th>...</th>\n",
       "      <th>H00_Marknadsvärde_Sum</th>\n",
       "      <th>H01_Marknadsvärde_Sum</th>\n",
       "      <th>H03_Marknadsvärde_Sum</th>\n",
       "      <th>H06_Marknadsvärde_Sum</th>\n",
       "      <th>H12_Marknadsvärde_Sum</th>\n",
       "      <th>H00_ÖverUnderVärde_Sum</th>\n",
       "      <th>H01_ÖverUnderVärde_Sum</th>\n",
       "      <th>H03_ÖverUnderVärde_Sum</th>\n",
       "      <th>H06_ÖverUnderVärde_Sum</th>\n",
       "      <th>H12_ÖverUnderVärde_Sum</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>0.044444</td>\n",
       "      <td>0.044444</td>\n",
       "      <td>0.044444</td>\n",
       "      <td>0.044444</td>\n",
       "      <td>368.822222</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>2</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>108777.333333</td>\n",
       "      <td>108853.888889</td>\n",
       "      <td>110165.444444</td>\n",
       "      <td>107994.777778</td>\n",
       "      <td>33774.111111</td>\n",
       "      <td>85178.111111</td>\n",
       "      <td>85239.144444</td>\n",
       "      <td>86065.235556</td>\n",
       "      <td>83954.896667</td>\n",
       "      <td>25721.618889</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>3</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.013333</td>\n",
       "      <td>0.012222</td>\n",
       "      <td>0.010000</td>\n",
       "      <td>0.007778</td>\n",
       "      <td>0.005556</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>4</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>14137.555556</td>\n",
       "      <td>13936.666667</td>\n",
       "      <td>13723.222222</td>\n",
       "      <td>13873.888889</td>\n",
       "      <td>NaN</td>\n",
       "      <td>545.064444</td>\n",
       "      <td>545.064444</td>\n",
       "      <td>572.286667</td>\n",
       "      <td>572.286667</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>5</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>511.113333</td>\n",
       "      <td>488.891111</td>\n",
       "      <td>444.446667</td>\n",
       "      <td>377.780000</td>\n",
       "      <td>244.444444</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>6</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>20160530.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>7</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>20160909.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>12480.777778</td>\n",
       "      <td>10259.333333</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>2095.274444</td>\n",
       "      <td>820.947778</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>8</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>20160428.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1066.777778</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>859.200000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>9</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>479.777778</td>\n",
       "      <td>495.111111</td>\n",
       "      <td>517.222222</td>\n",
       "      <td>515.888889</td>\n",
       "      <td>561.555556</td>\n",
       "      <td>306.422222</td>\n",
       "      <td>318.555556</td>\n",
       "      <td>322.577778</td>\n",
       "      <td>325.766667</td>\n",
       "      <td>334.211111</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>10</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>201501</td>\n",
       "      <td>201611</td>\n",
       "      <td>NaN</td>\n",
       "      <td>...</td>\n",
       "      <td>104100.000000</td>\n",
       "      <td>104100.000000</td>\n",
       "      <td>106600.000000</td>\n",
       "      <td>106600.000000</td>\n",
       "      <td>105030.000000</td>\n",
       "      <td>83280.000000</td>\n",
       "      <td>83280.000000</td>\n",
       "      <td>85280.000000</td>\n",
       "      <td>85280.000000</td>\n",
       "      <td>86480.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>10 rows × 167 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "   Kundnr  Status_L  Status_A  Target_Alla  Target_Helt  Target_Delvis  \\\n",
       "0       1         1         0            0            0              0   \n",
       "1       2         1         0            0            0              0   \n",
       "2       3         1         0            0            0              0   \n",
       "3       4         1         0            0            0              0   \n",
       "4       5         1         0            0            0              0   \n",
       "5       6         0         1            1            1              0   \n",
       "6       7         0         1            1            1              0   \n",
       "7       8         0         1            1            1              0   \n",
       "8       9         1         0            0            0              0   \n",
       "9      10         1         0            0            0              0   \n",
       "\n",
       "   Ref_Alla  Kundperiod_Min  Kundperiod_Max  Avslutsdatum_Max  \\\n",
       "0         1          201501          201611               NaN   \n",
       "1         1          201501          201611               NaN   \n",
       "2         1          201501          201611               NaN   \n",
       "3         1          201501          201611               NaN   \n",
       "4         1          201501          201611               NaN   \n",
       "5         0          201501          201611        20160530.0   \n",
       "6         0          201501          201611        20160909.0   \n",
       "7         0          201501          201611        20160428.0   \n",
       "8         1          201501          201611               NaN   \n",
       "9         1          201501          201611               NaN   \n",
       "\n",
       "            ...           H00_Marknadsvärde_Sum H01_Marknadsvärde_Sum  \\\n",
       "0           ...                             NaN                   NaN   \n",
       "1           ...                   108777.333333         108853.888889   \n",
       "2           ...                        0.000000              0.000000   \n",
       "3           ...                    14137.555556          13936.666667   \n",
       "4           ...                             NaN                   NaN   \n",
       "5           ...                        0.000000              0.000000   \n",
       "6           ...                        0.000000              0.000000   \n",
       "7           ...                        0.000000              0.000000   \n",
       "8           ...                      479.777778            495.111111   \n",
       "9           ...                   104100.000000         104100.000000   \n",
       "\n",
       "   H03_Marknadsvärde_Sum  H06_Marknadsvärde_Sum  H12_Marknadsvärde_Sum  \\\n",
       "0                    NaN                    NaN                    NaN   \n",
       "1          110165.444444          107994.777778           33774.111111   \n",
       "2               0.000000               0.000000               0.000000   \n",
       "3           13723.222222           13873.888889                    NaN   \n",
       "4                    NaN                    NaN                    NaN   \n",
       "5               0.000000               0.000000               0.000000   \n",
       "6               0.000000           12480.777778           10259.333333   \n",
       "7               0.000000               0.000000            1066.777778   \n",
       "8             517.222222             515.888889             561.555556   \n",
       "9          106600.000000          106600.000000          105030.000000   \n",
       "\n",
       "   H00_ÖverUnderVärde_Sum  H01_ÖverUnderVärde_Sum  H03_ÖverUnderVärde_Sum  \\\n",
       "0                0.044444                0.044444                0.044444   \n",
       "1            85178.111111            85239.144444            86065.235556   \n",
       "2                0.013333                0.012222                0.010000   \n",
       "3              545.064444              545.064444              572.286667   \n",
       "4              511.113333              488.891111              444.446667   \n",
       "5                0.000000                0.000000                0.000000   \n",
       "6                0.000000                0.000000                0.000000   \n",
       "7                0.000000                0.000000                0.000000   \n",
       "8              306.422222              318.555556              322.577778   \n",
       "9            83280.000000            83280.000000            85280.000000   \n",
       "\n",
       "   H06_ÖverUnderVärde_Sum  H12_ÖverUnderVärde_Sum  \n",
       "0                0.044444              368.822222  \n",
       "1            83954.896667            25721.618889  \n",
       "2                0.007778                0.005556  \n",
       "3              572.286667                0.000000  \n",
       "4              377.780000              244.444444  \n",
       "5                0.000000                0.000000  \n",
       "6             2095.274444              820.947778  \n",
       "7                0.000000              859.200000  \n",
       "8              325.766667              334.211111  \n",
       "9            85280.000000            86480.000000  \n",
       "\n",
       "[10 rows x 167 columns]"
      ]
     },
     "execution_count": 2,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_csv(\"LCI_Data_Set.txt\", sep=\"\\t\")\n",
    "df.head(10)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "We want to change columns containing dates to a format we can work with"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [],
   "source": [
    "df[\"Avslutsdatum_Max\"] = pd.to_datetime(df[\"Avslutsdatum_Max\"], format=\"%Y%m%d\")\n",
    "df[\"Kundperiod_Min\"] = pd.to_datetime(df[\"Kundperiod_Min\"], format=\"%Y%m\")\n",
    "df[\"Kundperiod_Max\"] = pd.to_datetime(df[\"Kundperiod_Max\"], format=\"%Y%m\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## Planned strategy\n",
    "- Take a closer look at the variables to see which ones are interesting to us. We want to look primarily at customer \n",
    "behavior (how active are they in terms of making transfers, logging in to their account and getting in contact with the bank)\n",
    "In addition to that, we also want to see if we can find trends in the behaviour - is the activity going up or down prior to closing and agreement?\n",
    "For this we can look at the two periods prior to the last closing.\n",
    "- Looking at external factors - we might be able to see a temporal trend among customers where we have spikes in closings.\n",
    "A possible reason for this might be a policy change made by the bank or perhaps an aggressive marketing campaign by a competitor\n",
    "- We want to see if there are some traits that distinguish customers who leave from those who stay. Since our target label is prone to change over time\n",
    "i.e a staying customer might leave the next day after our last measuring point, we should mitigate for this by perhaps at older periods of activity for these \"controls\"\n",
    "- When we have established the variables we are going to use in our initial analysis we should choose a appropriate model to start with.\n",
    "Since the problem is composed as a binary classification problem we could use something like Logistic Regression, a Support Vector Machine or decision tree model like random forest. In order to take into account for the relative small number customers who churn in respect to the ones who don't as well as for possible outliers, we ideally want to split our training set into several parts to do a five-fold cross validation of our model. (i.e traing five models on 80% of the data and taking an average of those models)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "##### We have many variables and it might be wise to lower the complexity by putting aside the ones we believe contribute little to customer decision\n",
    "Things that we are interested in are customer behavior, customer interaction and a change in any of those prior to closing agreements. \n",
    "In addition to that; looking at too many variables also increse the chance of finding a correlating variable simple due to the distribution of probabilities. "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 4,
   "metadata": {},
   "outputs": [],
   "source": [
    "customer_info_variables = [x for x in df.columns if \"Inlogg\" in x or \"Uppring\" in x]\n",
    "df = df[['Target_Alla', \n",
    "         'Target_Helt', \n",
    "         'Target_Delvis', \n",
    "         'Ref_Alla', \n",
    "         'Kundperiod_Min', \n",
    "         'Kundperiod_Max', \n",
    "         'Avslutsdatum_Max',\n",
    "         'H00_Kundsegment'] + customer_info_variables]"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### Since we assume that the way of logging contributes little to the tendency to close agreements, we sum them together"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "metadata": {},
   "outputs": [],
   "source": [
    "for period in ['H00', 'H01', 'H03', 'H06', 'H12']:\n",
    "    df[\"{}_Inlogg_total\".format(period)] = df['{}_Ant_Inlogg_Internetbank_Man'.format(period)] + df['{}_Ant_Inlogg_Mobilbank_Pri_Man'.format(period)] + df['{}_Ant_Inlogg_Mobilbank_Tab_Man'.format(period)]\n",
    "    \n",
    "columns_to_drop = [x for x in df.columns if \"Internetbank\" in x or \"Mobilbank\" in x]\n",
    "df = df.drop(columns=columns_to_drop)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "And see how our data looks now"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Target_Alla</th>\n",
       "      <th>Target_Helt</th>\n",
       "      <th>Target_Delvis</th>\n",
       "      <th>Ref_Alla</th>\n",
       "      <th>Kundperiod_Min</th>\n",
       "      <th>Kundperiod_Max</th>\n",
       "      <th>Avslutsdatum_Max</th>\n",
       "      <th>H00_Kundsegment</th>\n",
       "      <th>H00_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H01_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H03_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H06_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H12_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H00_Inlogg_total</th>\n",
       "      <th>H01_Inlogg_total</th>\n",
       "      <th>H03_Inlogg_total</th>\n",
       "      <th>H06_Inlogg_total</th>\n",
       "      <th>H12_Inlogg_total</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>NaT</td>\n",
       "      <td>P30</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>46.0</td>\n",
       "      <td>55.0</td>\n",
       "      <td>57.0</td>\n",
       "      <td>45.0</td>\n",
       "      <td>54.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>NaT</td>\n",
       "      <td>P10</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>7.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>28.0</td>\n",
       "      <td>4.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>NaT</td>\n",
       "      <td>P40</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>22.0</td>\n",
       "      <td>33.0</td>\n",
       "      <td>32.0</td>\n",
       "      <td>30.0</td>\n",
       "      <td>34.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>NaT</td>\n",
       "      <td>P20</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>31.0</td>\n",
       "      <td>26.0</td>\n",
       "      <td>14.0</td>\n",
       "      <td>12.0</td>\n",
       "      <td>17.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>NaT</td>\n",
       "      <td>P30</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>13.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>8.0</td>\n",
       "      <td>6.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "   Target_Alla  Target_Helt  Target_Delvis  Ref_Alla Kundperiod_Min  \\\n",
       "0            0            0              0         1     2015-01-01   \n",
       "1            0            0              0         1     2015-01-01   \n",
       "2            0            0              0         1     2015-01-01   \n",
       "3            0            0              0         1     2015-01-01   \n",
       "4            0            0              0         1     2015-01-01   \n",
       "\n",
       "  Kundperiod_Max Avslutsdatum_Max H00_Kundsegment  \\\n",
       "0     2016-11-01              NaT             P30   \n",
       "1     2016-11-01              NaT             P10   \n",
       "2     2016-11-01              NaT             P40   \n",
       "3     2016-11-01              NaT             P20   \n",
       "4     2016-11-01              NaT             P30   \n",
       "\n",
       "   H00_Ant_Uppring_Telbank_PS_Man  H01_Ant_Uppring_Telbank_PS_Man  \\\n",
       "0                             0.0                             0.0   \n",
       "1                             0.0                             0.0   \n",
       "2                             1.0                             1.0   \n",
       "3                             0.0                             0.0   \n",
       "4                             0.0                             0.0   \n",
       "\n",
       "   H03_Ant_Uppring_Telbank_PS_Man  H06_Ant_Uppring_Telbank_PS_Man  \\\n",
       "0                             0.0                             0.0   \n",
       "1                             0.0                             0.0   \n",
       "2                             2.0                             2.0   \n",
       "3                             0.0                             0.0   \n",
       "4                             0.0                             0.0   \n",
       "\n",
       "   H12_Ant_Uppring_Telbank_PS_Man  H00_Inlogg_total  H01_Inlogg_total  \\\n",
       "0                             0.0              46.0              55.0   \n",
       "1                             0.0               7.0               7.0   \n",
       "2                             3.0              22.0              33.0   \n",
       "3                             0.0              31.0              26.0   \n",
       "4                             0.0               5.0              13.0   \n",
       "\n",
       "   H03_Inlogg_total  H06_Inlogg_total  H12_Inlogg_total  \n",
       "0              57.0              45.0              54.0  \n",
       "1               8.0              28.0               4.0  \n",
       "2              32.0              30.0              34.0  \n",
       "3              14.0              12.0              17.0  \n",
       "4               3.0               8.0               6.0  "
      ]
     },
     "execution_count": 6,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Target_Alla</th>\n",
       "      <th>Target_Helt</th>\n",
       "      <th>Target_Delvis</th>\n",
       "      <th>Ref_Alla</th>\n",
       "      <th>H00_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H01_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H03_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H06_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H12_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H00_Inlogg_total</th>\n",
       "      <th>H01_Inlogg_total</th>\n",
       "      <th>H03_Inlogg_total</th>\n",
       "      <th>H06_Inlogg_total</th>\n",
       "      <th>H12_Inlogg_total</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>count</th>\n",
       "      <td>38751.000000</td>\n",
       "      <td>38751.000000</td>\n",
       "      <td>38751.000000</td>\n",
       "      <td>38751.000000</td>\n",
       "      <td>38259.000000</td>\n",
       "      <td>38303.000000</td>\n",
       "      <td>38354.000000</td>\n",
       "      <td>38405.000000</td>\n",
       "      <td>38291.000000</td>\n",
       "      <td>38261.000000</td>\n",
       "      <td>38307.000000</td>\n",
       "      <td>38360.000000</td>\n",
       "      <td>38410.000000</td>\n",
       "      <td>38292.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>mean</th>\n",
       "      <td>0.200021</td>\n",
       "      <td>0.155454</td>\n",
       "      <td>0.044567</td>\n",
       "      <td>0.799979</td>\n",
       "      <td>0.146319</td>\n",
       "      <td>0.118294</td>\n",
       "      <td>0.108150</td>\n",
       "      <td>0.099336</td>\n",
       "      <td>0.110156</td>\n",
       "      <td>35.947544</td>\n",
       "      <td>35.390686</td>\n",
       "      <td>36.719343</td>\n",
       "      <td>34.631502</td>\n",
       "      <td>32.768490</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>std</th>\n",
       "      <td>0.400021</td>\n",
       "      <td>0.362342</td>\n",
       "      <td>0.206353</td>\n",
       "      <td>0.400021</td>\n",
       "      <td>0.641070</td>\n",
       "      <td>0.537338</td>\n",
       "      <td>0.542929</td>\n",
       "      <td>0.498932</td>\n",
       "      <td>0.588196</td>\n",
       "      <td>73.823312</td>\n",
       "      <td>71.025842</td>\n",
       "      <td>77.063428</td>\n",
       "      <td>70.589360</td>\n",
       "      <td>267.905641</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>min</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25%</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>4.000000</td>\n",
       "      <td>4.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>50%</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>15.000000</td>\n",
       "      <td>14.000000</td>\n",
       "      <td>13.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>75%</th>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>0.000000</td>\n",
       "      <td>39.000000</td>\n",
       "      <td>39.000000</td>\n",
       "      <td>40.000000</td>\n",
       "      <td>39.000000</td>\n",
       "      <td>33.000000</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>max</th>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>1.000000</td>\n",
       "      <td>29.000000</td>\n",
       "      <td>21.000000</td>\n",
       "      <td>27.000000</td>\n",
       "      <td>33.000000</td>\n",
       "      <td>48.000000</td>\n",
       "      <td>2766.000000</td>\n",
       "      <td>3334.000000</td>\n",
       "      <td>3490.000000</td>\n",
       "      <td>2401.000000</td>\n",
       "      <td>50547.000000</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "        Target_Alla   Target_Helt  Target_Delvis      Ref_Alla  \\\n",
       "count  38751.000000  38751.000000   38751.000000  38751.000000   \n",
       "mean       0.200021      0.155454       0.044567      0.799979   \n",
       "std        0.400021      0.362342       0.206353      0.400021   \n",
       "min        0.000000      0.000000       0.000000      0.000000   \n",
       "25%        0.000000      0.000000       0.000000      1.000000   \n",
       "50%        0.000000      0.000000       0.000000      1.000000   \n",
       "75%        0.000000      0.000000       0.000000      1.000000   \n",
       "max        1.000000      1.000000       1.000000      1.000000   \n",
       "\n",
       "       H00_Ant_Uppring_Telbank_PS_Man  H01_Ant_Uppring_Telbank_PS_Man  \\\n",
       "count                    38259.000000                    38303.000000   \n",
       "mean                         0.146319                        0.118294   \n",
       "std                          0.641070                        0.537338   \n",
       "min                          0.000000                        0.000000   \n",
       "25%                          0.000000                        0.000000   \n",
       "50%                          0.000000                        0.000000   \n",
       "75%                          0.000000                        0.000000   \n",
       "max                         29.000000                       21.000000   \n",
       "\n",
       "       H03_Ant_Uppring_Telbank_PS_Man  H06_Ant_Uppring_Telbank_PS_Man  \\\n",
       "count                    38354.000000                    38405.000000   \n",
       "mean                         0.108150                        0.099336   \n",
       "std                          0.542929                        0.498932   \n",
       "min                          0.000000                        0.000000   \n",
       "25%                          0.000000                        0.000000   \n",
       "50%                          0.000000                        0.000000   \n",
       "75%                          0.000000                        0.000000   \n",
       "max                         27.000000                       33.000000   \n",
       "\n",
       "       H12_Ant_Uppring_Telbank_PS_Man  H00_Inlogg_total  H01_Inlogg_total  \\\n",
       "count                    38291.000000      38261.000000      38307.000000   \n",
       "mean                         0.110156         35.947544         35.390686   \n",
       "std                          0.588196         73.823312         71.025842   \n",
       "min                          0.000000          0.000000          0.000000   \n",
       "25%                          0.000000          4.000000          4.000000   \n",
       "50%                          0.000000         15.000000         15.000000   \n",
       "75%                          0.000000         39.000000         39.000000   \n",
       "max                         48.000000       2766.000000       3334.000000   \n",
       "\n",
       "       H03_Inlogg_total  H06_Inlogg_total  H12_Inlogg_total  \n",
       "count      38360.000000      38410.000000      38292.000000  \n",
       "mean          36.719343         34.631502         32.768490  \n",
       "std           77.063428         70.589360        267.905641  \n",
       "min            0.000000          0.000000          0.000000  \n",
       "25%            4.000000          4.000000          4.000000  \n",
       "50%           15.000000         14.000000         13.000000  \n",
       "75%           40.000000         39.000000         33.000000  \n",
       "max         3490.000000       2401.000000      50547.000000  "
      ]
     },
     "execution_count": 7,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df.describe()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "##### Create subsets dataframes for target and reference clients and fill missing values with zeros.\n",
    "Filling missing values is not always straightforward and might introduce unbalanced data. Since the values we are filling are postive discrete counts of interactions where the mean is around 35, filling these with zeros can be considered reasonably safe."
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_target_all = df[df[\"Target_Alla\"]==1].fillna(value=0)\n",
    "df_target_full = df[df[\"Target_Helt\"]==1].fillna(value=0)\n",
    "df_target_part = df[df[\"Target_Delvis\"]==1].fillna(value=0)\n",
    "df_ref_all = df[df[\"Ref_Alla\"]==1].fillna(value=0)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Sanity check that the numbers add up"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "True"
      ]
     },
     "execution_count": 9,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(df_target_all) == len(df_target_part) + len(df_target_full)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "##### Let's see if there is a temporal aspect first of all\n",
    "If we see any spikes in closing of agreements we can look closer into that time period "
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "<matplotlib.axes._subplots.AxesSubplot at 0x9d873c8>"
      ]
     },
     "execution_count": 10,
     "metadata": {},
     "output_type": "execute_result"
    },
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<matplotlib.figure.Figure at 0x5806550>"
      ]
     },
     "metadata": {},
     "output_type": "display_data"
    }
   ],
   "source": [
    "df_target_all[\"Avslutsdatum_Max\"].dt.month.value_counts().sort_index().plot(kind=\"line\", \n",
    "                                                                             ylim={0, 1000}, \n",
    "                                                                             figsize=(16, 4),\n",
    "                                                                            xticks=range(1,13),\n",
    "                                                                            title=\"Closings per month 2016\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Nothing stands out as extraoridniary except the fact that we have somewhat higher churn in January. This could however be and artifact due to some contracts end automatically at the end of a year for example"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "#### To see trends in customer behavior we need to find out which periods corresponds to those prior to a closing\n",
    "Instead of looking at all previous period, we will focus at the two previous periods of activity before closing an agreement since we consider them to be most interesting"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "metadata": {},
   "outputs": [],
   "source": [
    "def get_last_two_active_periods(month):\n",
    "    if month > 10:\n",
    "        return (\"H00\", \"H01\")\n",
    "    elif  10 <= month > 8:\n",
    "        return (\"H01\", \"H03\")\n",
    "    elif 8 >= month >5:\n",
    "        return (\"H03\", \"H06\")\n",
    "    else:\n",
    "        return (\"H06\", \"H12\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "metadata": {},
   "outputs": [],
   "source": [
    "closing_months = df_target_all[\"Avslutsdatum_Max\"].dt.month"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 13,
   "metadata": {},
   "outputs": [],
   "source": [
    "rows = [row for index, row in df_target_all.iterrows()]\n",
    "\n",
    "last_period_logins = [\"{}_Inlogg_total\".format(get_last_two_active_periods(x)[0]) for x in closing_months]\n",
    "second_last_period_logins = [\"{}_Inlogg_total\".format(get_last_two_active_periods(x)[1]) for x in closing_months]\n",
    "df_target_all.loc[:,\"num_login_last\"] = pd.Series([row[col] for row, col in zip(rows, last_period_logins)], index=df_target_all.index)\n",
    "df_target_all.loc[:,\"num_login_second_last\"] = pd.Series([row[col] for row, col in zip(rows, second_last_period_logins)], index=df_target_all.index)\n",
    "df_target_all[\"delta_login_activity\"] = (df_target_all[\"num_login_last\"] - df_target_all[\"num_login_second_last\"])\n",
    "\n",
    "last_period_calls = [\"{}_Ant_Uppring_Telbank_PS_Man\".format(get_last_two_active_periods(x)[0]) for x in closing_months]\n",
    "second_last_period_calls = [\"{}_Ant_Uppring_Telbank_PS_Man\".format(get_last_two_active_periods(x)[1]) for x in closing_months]\n",
    "df_target_all.loc[:,\"num_calls_last\"] = pd.Series([row[col] for row, col in zip(rows, last_period_calls)], index=df_target_all.index)\n",
    "df_target_all.loc[:,\"num_calls_second_last\"] = pd.Series([row[col] for row, col in zip(rows, second_last_period_calls)], index=df_target_all.index)\n",
    "df_target_all[\"delta_calls_activity\"] = (df_target_all[\"num_calls_last\"] - df_target_all[\"num_calls_second_last\"])"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Now we have thee extra columns for each activity type:\n",
    "    - Number of interactions for their last period\n",
    "    - Numner of interactions for their second to last period\n",
    "    - The difference in activity (delta) between them both"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 17,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Target_Alla</th>\n",
       "      <th>Target_Helt</th>\n",
       "      <th>Target_Delvis</th>\n",
       "      <th>Ref_Alla</th>\n",
       "      <th>Kundperiod_Min</th>\n",
       "      <th>Kundperiod_Max</th>\n",
       "      <th>Avslutsdatum_Max</th>\n",
       "      <th>H00_Kundsegment</th>\n",
       "      <th>H00_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H01_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>...</th>\n",
       "      <th>H06_Inlogg_total</th>\n",
       "      <th>H12_Inlogg_total</th>\n",
       "      <th>num_login_last</th>\n",
       "      <th>num_login_second_last</th>\n",
       "      <th>delta_login_activity</th>\n",
       "      <th>num_calls_last</th>\n",
       "      <th>num_calls_second_last</th>\n",
       "      <th>delta_calls_activity</th>\n",
       "      <th>delta_calls_normalized</th>\n",
       "      <th>delta_login_normalized</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>2016-05-30</td>\n",
       "      <td>P20</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>6.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>2016-09-09</td>\n",
       "      <td>CMI</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>...</td>\n",
       "      <td>101.0</td>\n",
       "      <td>117.0</td>\n",
       "      <td>101.0</td>\n",
       "      <td>117.0</td>\n",
       "      <td>-16.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>-1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>2016-04-28</td>\n",
       "      <td>P20</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>20.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>20.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-02-01</td>\n",
       "      <td>2016-09-02</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>2016-07-11</td>\n",
       "      <td>P50</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>4.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 26 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Target_Alla  Target_Helt  Target_Delvis  Ref_Alla Kundperiod_Min  \\\n",
       "5             1            1              0         0     2015-01-01   \n",
       "6             1            1              0         0     2015-01-01   \n",
       "7             1            1              0         0     2015-01-01   \n",
       "12            1            1              0         0     2015-01-01   \n",
       "14            1            1              0         0     2015-01-01   \n",
       "\n",
       "   Kundperiod_Max Avslutsdatum_Max H00_Kundsegment  \\\n",
       "5      2016-11-01       2016-05-30             P20   \n",
       "6      2016-11-01       2016-09-09             CMI   \n",
       "7      2016-11-01       2016-04-28             P20   \n",
       "12     2016-02-01       2016-09-02               0   \n",
       "14     2016-11-01       2016-07-11             P50   \n",
       "\n",
       "    H00_Ant_Uppring_Telbank_PS_Man  H01_Ant_Uppring_Telbank_PS_Man  \\\n",
       "5                              3.0                             0.0   \n",
       "6                              0.0                             1.0   \n",
       "7                              0.0                             0.0   \n",
       "12                             0.0                             0.0   \n",
       "14                             0.0                             0.0   \n",
       "\n",
       "             ...            H06_Inlogg_total  H12_Inlogg_total  \\\n",
       "5            ...                         6.0               6.0   \n",
       "6            ...                       101.0             117.0   \n",
       "7            ...                        20.0              16.0   \n",
       "12           ...                         0.0               3.0   \n",
       "14           ...                         4.0               5.0   \n",
       "\n",
       "    num_login_last  num_login_second_last  delta_login_activity  \\\n",
       "5              6.0                    6.0                   0.0   \n",
       "6            101.0                  117.0                 -16.0   \n",
       "7             20.0                   16.0                   4.0   \n",
       "12             0.0                    3.0                  -3.0   \n",
       "14             5.0                    4.0                   1.0   \n",
       "\n",
       "    num_calls_last  num_calls_second_last  delta_calls_activity  \\\n",
       "5              0.0                    0.0                   0.0   \n",
       "6              2.0                    0.0                   2.0   \n",
       "7              0.0                    0.0                   0.0   \n",
       "12             0.0                    0.0                   0.0   \n",
       "14             1.0                    0.0                   1.0   \n",
       "\n",
       "    delta_calls_normalized  delta_login_normalized  \n",
       "5                      0.0                    -1.0  \n",
       "6                      1.0                    -1.0  \n",
       "7                      0.0                     0.0  \n",
       "12                     0.0                    -1.0  \n",
       "14                     1.0                     0.0  \n",
       "\n",
       "[5 rows x 26 columns]"
      ]
     },
     "execution_count": 17,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_target_all.head()"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "To make the delta activity column more useful, we want to normalize the values by dividing them by the number of interations for the second to last period\n",
    "Where the latter value is zero and the delta above zero, we consider that to be and 100% increase (i.e 1)\n",
    "Where delta is zero and the value for second to last period is above zero we set consider that valuea to be -100%"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 15,
   "metadata": {},
   "outputs": [],
   "source": [
    "df_target_all['delta_calls_normalized'] = [1.0 if x!=0 and y==0 else -1.0 if x==0 and y!=0 else 0 if x==0 and y==0 else x//y for x,y in zip(df_target_all['delta_calls_activity'], df_target_all['num_calls_second_last'])]\n",
    "df_target_all['delta_login_normalized'] = [1.0 if x!=0 and y==0 else -1.0 if x==0 and y!=0 else 0 if x==0 and y==0 else x//y for x,y in zip(df_target_all['delta_login_activity'], df_target_all['num_login_second_last'])]"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 18,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>Target_Alla</th>\n",
       "      <th>Target_Helt</th>\n",
       "      <th>Target_Delvis</th>\n",
       "      <th>Ref_Alla</th>\n",
       "      <th>Kundperiod_Min</th>\n",
       "      <th>Kundperiod_Max</th>\n",
       "      <th>Avslutsdatum_Max</th>\n",
       "      <th>H00_Kundsegment</th>\n",
       "      <th>H00_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>H01_Ant_Uppring_Telbank_PS_Man</th>\n",
       "      <th>...</th>\n",
       "      <th>H06_Inlogg_total</th>\n",
       "      <th>H12_Inlogg_total</th>\n",
       "      <th>num_login_last</th>\n",
       "      <th>num_login_second_last</th>\n",
       "      <th>delta_login_activity</th>\n",
       "      <th>num_calls_last</th>\n",
       "      <th>num_calls_second_last</th>\n",
       "      <th>delta_calls_activity</th>\n",
       "      <th>delta_calls_normalized</th>\n",
       "      <th>delta_login_normalized</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>2016-05-30</td>\n",
       "      <td>P20</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>6.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>6.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>2016-09-09</td>\n",
       "      <td>CMI</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>...</td>\n",
       "      <td>101.0</td>\n",
       "      <td>117.0</td>\n",
       "      <td>101.0</td>\n",
       "      <td>117.0</td>\n",
       "      <td>-16.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>2.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>-1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>2016-04-28</td>\n",
       "      <td>P20</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>20.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>20.0</td>\n",
       "      <td>16.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-02-01</td>\n",
       "      <td>2016-09-02</td>\n",
       "      <td>0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>3.0</td>\n",
       "      <td>-3.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>-1.0</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>1</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>2015-01-01</td>\n",
       "      <td>2016-11-01</td>\n",
       "      <td>2016-07-11</td>\n",
       "      <td>P50</td>\n",
       "      <td>0.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>...</td>\n",
       "      <td>4.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>5.0</td>\n",
       "      <td>4.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>1.0</td>\n",
       "      <td>0.0</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>5 rows × 26 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    Target_Alla  Target_Helt  Target_Delvis  Ref_Alla Kundperiod_Min  \\\n",
       "5             1            1              0         0     2015-01-01   \n",
       "6             1            1              0         0     2015-01-01   \n",
       "7             1            1              0         0     2015-01-01   \n",
       "12            1            1              0         0     2015-01-01   \n",
       "14            1            1              0         0     2015-01-01   \n",
       "\n",
       "   Kundperiod_Max Avslutsdatum_Max H00_Kundsegment  \\\n",
       "5      2016-11-01       2016-05-30             P20   \n",
       "6      2016-11-01       2016-09-09             CMI   \n",
       "7      2016-11-01       2016-04-28             P20   \n",
       "12     2016-02-01       2016-09-02               0   \n",
       "14     2016-11-01       2016-07-11             P50   \n",
       "\n",
       "    H00_Ant_Uppring_Telbank_PS_Man  H01_Ant_Uppring_Telbank_PS_Man  \\\n",
       "5                              3.0                             0.0   \n",
       "6                              0.0                             1.0   \n",
       "7                              0.0                             0.0   \n",
       "12                             0.0                             0.0   \n",
       "14                             0.0                             0.0   \n",
       "\n",
       "             ...            H06_Inlogg_total  H12_Inlogg_total  \\\n",
       "5            ...                         6.0               6.0   \n",
       "6            ...                       101.0             117.0   \n",
       "7            ...                        20.0              16.0   \n",
       "12           ...                         0.0               3.0   \n",
       "14           ...                         4.0               5.0   \n",
       "\n",
       "    num_login_last  num_login_second_last  delta_login_activity  \\\n",
       "5              6.0                    6.0                   0.0   \n",
       "6            101.0                  117.0                 -16.0   \n",
       "7             20.0                   16.0                   4.0   \n",
       "12             0.0                    3.0                  -3.0   \n",
       "14             5.0                    4.0                   1.0   \n",
       "\n",
       "    num_calls_last  num_calls_second_last  delta_calls_activity  \\\n",
       "5              0.0                    0.0                   0.0   \n",
       "6              2.0                    0.0                   2.0   \n",
       "7              0.0                    0.0                   0.0   \n",
       "12             0.0                    0.0                   0.0   \n",
       "14             1.0                    0.0                   1.0   \n",
       "\n",
       "    delta_calls_normalized  delta_login_normalized  \n",
       "5                      0.0                    -1.0  \n",
       "6                      1.0                    -1.0  \n",
       "7                      0.0                     0.0  \n",
       "12                     0.0                    -1.0  \n",
       "14                     1.0                     0.0  \n",
       "\n",
       "[5 rows x 26 columns]"
      ]
     },
     "execution_count": 18,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_target_all.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 32,
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "More calls: 7.39%\n",
      "Less calls: 8.3%\n",
      "More logins: 15.3%\n",
      "Less logins: 42.3%\n"
     ]
    }
   ],
   "source": [
    "total_number_targets = len(df_target_all)\n",
    "percent_more_calls = len(df_target_all[df_target_all['delta_calls_normalized'] > 0]) / total_number_targets * 100\n",
    "percent_less_calls = len(df_target_all[df_target_all['delta_calls_normalized'] < 0]) / total_number_targets * 100\n",
    "print(\"More calls: {0:.3}%\".format(percent_more_calls))\n",
    "print(\"Less calls: {0:.3}%\".format(percent_less_calls))\n",
    "\n",
    "percent_more_logins = len(df_target_all[df_target_all['delta_login_normalized'] > 0]) / total_number_targets * 100\n",
    "percent_less_logins = len(df_target_all[df_target_all['delta_login_normalized'] < 0]) / total_number_targets * 100\n",
    "print(\"More logins: {0:.3}%\".format(percent_more_logins))\n",
    "print(\"Less logins: {0:.3}%\".format(percent_less_logins))"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "This is still a crude measure but the login activity might hint to something"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "35392"
      ]
     },
     "execution_count": 43,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "len(df[[x in [\"P10\",\"P20\",\"P30\",\"P40\",\"P50\",\"P60\",\"P70\",\"P80\",] for x in df[\"H00_Kundsegment\"].replace(0.0, 'X')]])"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.6.4"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
